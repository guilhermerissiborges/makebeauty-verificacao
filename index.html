<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueTouch‚Ñ¢ - Verifica√ß√£o Make Beauty</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .animate-gradient {
            background-size: 200% 200%;
            animation: gradient 3s ease infinite;
        }
        @keyframes phone-approach {
            0% { transform: translateY(-60px) translateX(20px) rotate(-8deg); }
            50% { transform: translateY(10px) translateX(0) rotate(-3deg); }
            100% { transform: translateY(-60px) translateX(20px) rotate(-8deg); }
        }
        .animate-phone-approach {
            animation: phone-approach 3s ease-in-out infinite;
        }
        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(1.4);
                opacity: 0;
            }
        }
        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-black text-white min-h-screen">
    <div class="max-w-2xl mx-auto p-6">
        <div class="text-center mb-8 mt-8">
            <div class="inline-block p-3 bg-gradient-to-r from-pink-500/20 to-purple-500/20 rounded-2xl mb-4">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-pink-400">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
            </div>
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent animate-gradient">
                TrueTouch‚Ñ¢
            </h1>
            <p class="text-gray-400">Sistema de Verifica√ß√£o de Autenticidade</p>
        </div>

        <div class="bg-white/5 backdrop-blur-xl rounded-3xl p-8 border border-white/10">
            <div id="scan-area" class="text-center">
                <!-- Ilustra√ß√£o da m√£o segurando celular aproximando da tag -->
                <div class="relative w-64 h-80 mx-auto mb-6">
                    <!-- Tag NFC (fixa no centro-baixo) -->
                    <div class="absolute bottom-8 left-1/2 -translate-x-1/2">
                        <div class="relative">
                            <!-- Ondas de sinal -->
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="w-24 h-24 rounded-full bg-purple-500/30 pulse-ring"></div>
                                <div class="absolute w-24 h-24 rounded-full bg-purple-500/30 pulse-ring" style="animation-delay: 0.5s;"></div>
                                <div class="absolute w-24 h-24 rounded-full bg-purple-500/30 pulse-ring" style="animation-delay: 1s;"></div>
                            </div>
                            <!-- Produto com Tag -->
                            <svg width="80" height="80" viewBox="0 0 80 80" class="relative z-10">
                                <!-- Frasco/Produto -->
                                <rect x="15" y="20" width="50" height="45" rx="8" fill="#e9d5ff" opacity="0.3"/>
                                <rect x="20" y="25" width="40" height="35" rx="6" fill="#c084fc" opacity="0.4"/>
                                
                                <!-- Tag TrueTouch -->
                                <g transform="translate(25, 30)">
                                    <rect x="0" y="0" width="30" height="25" rx="3" fill="#9333ea" opacity="0.5"/>
                                    <circle cx="15" cy="12" r="8" fill="#a855f7"/>
                                    <circle cx="15" cy="12" r="5" fill="#c084fc" opacity="0.7"/>
                                    <circle cx="15" cy="12" r="2" fill="#e9d5ff"/>
                                    <text x="15" y="23" text-anchor="middle" fill="#fff" font-size="4" font-weight="bold">NFC</text>
                                </g>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- M√£o + Smartphone (animado aproximando) -->
                    <div class="absolute top-0 left-1/2 -translate-x-1/2 animate-phone-approach">
                        <svg width="140" height="200" viewBox="0 0 140 200">
                            <!-- M√£o -->
                            <g transform="translate(10, 80)">
                                <!-- Pulso -->
                                <ellipse cx="35" cy="90" rx="20" ry="12" fill="#d4a574" opacity="0.9"/>
                                
                                <!-- Palma -->
                                <path d="M 20 70 Q 15 80, 20 90 L 50 90 Q 55 80, 50 70 Z" fill="#d4a574"/>
                                
                                <!-- Polegar -->
                                <ellipse cx="15" cy="60" rx="8" ry="15" fill="#d4a574" transform="rotate(-20 15 60)"/>
                                <ellipse cx="12" cy="50" rx="6" ry="10" fill="#c9995e" transform="rotate(-20 12 50)"/>
                                
                                <!-- Dedos segurando o lado -->
                                <ellipse cx="55" cy="55" rx="6" ry="18" fill="#d4a574"/>
                                <ellipse cx="58" cy="40" rx="5" ry="12" fill="#c9995e"/>
                            </g>
                            
                            <!-- Smartphone -->
                            <g transform="translate(25, 20)">
                                <!-- Corpo do celular -->
                                <rect x="0" y="0" width="90" height="160" rx="12" fill="#1f2937" stroke="#374151" stroke-width="2"/>
                                
                                <!-- Tela -->
                                <rect x="5" y="8" width="80" height="144" rx="8" fill="#111827"/>
                                
                                <!-- Conte√∫do da tela - Logo TrueTouch -->
                                <g transform="translate(45, 50)">
                                    <!-- Escudo -->
                                    <path d="M 0 -25 L 15 -30 L 15 -10 Q 15 10, 0 20 Q -15 10, -15 -10 L -15 -30 Z" 
                                          fill="url(#grad1)" stroke="#a855f7" stroke-width="1.5"/>
                                    
                                    <!-- S√≠mbolo NFC -->
                                    <circle cx="0" cy="-5" r="8" fill="none" stroke="#e9d5ff" stroke-width="1.5"/>
                                    <path d="M 0 -10 Q 6 -8, 6 -5 Q 6 -2, 0 0" 
                                          stroke="#fff" stroke-width="2" fill="none" stroke-linecap="round"/>
                                    <circle cx="0" cy="-5" r="2" fill="#fff"/>
                                </g>
                                
                                <!-- Texto TrueTouch -->
                                <text x="45" y="110" text-anchor="middle" fill="#a855f7" font-size="11" font-weight="bold" font-family="Arial">
                                    TrueTouch‚Ñ¢
                                </text>
                                <text x="45" y="125" text-anchor="middle" fill="#6b7280" font-size="7" font-family="Arial">
                                    Aproxime da tag
                                </text>
                                
                                <!-- Bot√£o home/barra -->
                                <rect x="35" y="150" width="20" height="3" rx="1.5" fill="#374151"/>
                                
                                <!-- Notch/c√¢mera frontal -->
                                <ellipse cx="45" cy="4" rx="8" ry="2" fill="#000"/>
                            </g>
                            
                            <!-- Gradiente -->
                            <defs>
                                <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ec4899;stop-opacity:0.8" />
                                    <stop offset="100%" style="stop-color:#9333ea;stop-opacity:0.8" />
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                </div>

                <h2 class="text-2xl font-bold mb-4">Verificar Produto</h2>
                <p class="text-gray-400 mb-6">
                    Aproxime seu smartphone da tag TrueTouch‚Ñ¢ no produto Make Beauty
                </p>
                
                <div class="space-y-3">
                    <button 
                        onclick="scanNFC()"
                        class="w-full py-4 px-6 bg-gradient-to-r from-pink-500 to-purple-600 rounded-xl font-semibold hover:shadow-2xl hover:shadow-pink-500/50 transition-all"
                    >
                        Escanear NFC
                    </button>
                    
                    <button 
                        onclick="simulateScan()"
                        class="w-full py-4 px-6 bg-white/10 border border-white/20 rounded-xl font-semibold hover:bg-white/20 transition-all"
                    >
                        Demonstra√ß√£o (Simular)
                    </button>

                    <div class="pt-4 border-t border-white/10">
                        <p class="text-sm text-gray-400 mb-3">Modo Teste - Digite um UID da planilha:</p>
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                id="test-uid" 
                                placeholder="Ex: 04:E3:2A:1B:5F:80:80"
                                class="flex-1 px-4 py-3 bg-white/5 border border-white/20 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-pink-500"
                            />
                            <button 
                                onclick="testWithUID()"
                                class="px-6 py-3 bg-blue-500/80 hover:bg-blue-500 rounded-xl font-semibold transition-all"
                            >
                                Testar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="result-area" class="hidden"></div>
        </div>

        <div class="text-center text-sm text-gray-500 mt-8">
            <p>üí° <span class="text-gray-400">Dica:</span> Encoste a parte traseira superior do celular bem pr√≥xima √† tag</p>
            <p class="mt-2">Protegido por TrueTouch‚Ñ¢</p>
            <p class="mt-1">Tecnologia anti-falsifica√ß√£o Make Beauty</p>
        </div>
    </div>

    <script>
        const API_URL = 'https://makebeauty-nfc-backend.onrender.com';

        async function scanNFC() {
            if (!('NDEFReader' in window)) {
                alert('Seu navegador n√£o suporta NFC. Use Chrome no Android para escanear tags reais.');
                return;
            }

            try {
                const ndef = new NDEFReader();
                await ndef.scan();
                
                document.getElementById('scan-area').innerHTML = `
                    <div class="text-center py-8">
                        <div class="w-24 h-24 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                        <h3 class="text-xl font-bold mb-2">Escaneando...</h3>
                        <p class="text-gray-400">Mantenha o celular pr√≥ximo √† tag NFC</p>
                    </div>
                `;

                ndef.addEventListener('reading', async ({ message, serialNumber }) => {
                    const uid = serialNumber;
                    
                    let signature = '';
                    let counter = 0;
                    
                    for (const record of message.records) {
                        const decoder = new TextDecoder();
                        const data = decoder.decode(record.data);
                        const parts = data.split(':');
                        if (parts.length === 2) {
                            signature = parts[0];
                            counter = parseInt(parts[1]);
                        }
                    }

                    if (!signature) {
                        const array = new Uint8Array(32);
                        crypto.getRandomValues(array);
                        signature = Array.from(array).map(b => b.toString(16).padStart(2, '0')).join('');
                        counter = Math.floor(Math.random() * 100);
                    }

                    await verifyProduct(uid, signature, counter);
                });

            } catch (error) {
                alert('Erro ao iniciar scanner: ' + error.message);
            }
        }

        async function simulateScan() {
            document.getElementById('scan-area').innerHTML = `
                <div class="text-center py-8">
                    <div class="w-24 h-24 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                    <h3 class="text-xl font-bold mb-2">Simulando scan...</h3>
                </div>
            `;

            setTimeout(async () => {
                const uid = '04:AA:BB:CC:DD:EE:FF';
                const array = new Uint8Array(32);
                crypto.getRandomValues(array);
                const signature = Array.from(array).map(b => b.toString(16).padStart(2, '0')).join('');
                const counter = Math.floor(Math.random() * 100);
                await verifyProduct(uid, signature, counter);
            }, 2000);
        }

        async function testWithUID() {
            const input = document.getElementById('test-uid');
            let uid = input.value.trim();

            if (!uid) {
                alert('Digite um UID para testar');
                return;
            }

            uid = uid.replace(/[^0-9A-Fa-f]/g, '');
            
            if (uid.length < 14) {
                alert('UID inv√°lido. Digite no formato: 04:E3:2A:1B:5F:80:80');
                return;
            }

            const formattedUID = uid.match(/.{1,2}/g).join(':').toUpperCase();

            document.getElementById('scan-area').innerHTML = `
                <div class="text-center py-8">
                    <div class="w-24 h-24 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                    <h3 class="text-xl font-bold mb-2">Testando UID...</h3>
                    <p class="text-gray-400 text-sm">${formattedUID}</p>
                </div>
            `;

            const array = new Uint8Array(32);
            crypto.getRandomValues(array);
            const signature = Array.from(array).map(b => b.toString(16).padStart(2, '0')).join('');
            const counter = Math.floor(Math.random() * 100);

            await verifyProduct(formattedUID, signature, counter);
        }

        async function verifyProduct(uid, signature, counter) {
            try {
                const response = await fetch(`${API_URL}/api/verify-product`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ uid, signature, counter, location: 'Web' })
                });

                const data = await response.json();

                if (data.success && data.authentic) {
                    showSuccess(data.product);
                } else {
                    showError(data.error);
                }

            } catch (error) {
                showError('Erro ao conectar com servidor: ' + error.message);
            }
        }

        function showSuccess(product) {
            document.getElementById('scan-area').innerHTML = '';
            document.getElementById('result-area').className = 'space-y-6';
            document.getElementById('result-area').innerHTML = `
                <div class="text-center pb-6 border-b border-white/10">
                    <div class="inline-block p-4 bg-green-500/20 rounded-full mb-4">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-400">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-green-400 mb-2">Produto Aut√™ntico</h3>
                    <p class="text-gray-400">Este produto Make Beauty √© 100% original</p>
                </div>

                <div class="space-y-4">
                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">Produto</p>
                            <p class="font-semibold">${product.name}</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">ID do Produto</p>
                            <p class="font-mono text-sm">${product.productId}</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">Fabrica√ß√£o</p>
                            <p class="font-semibold">${new Date(product.manufacturingDate).toLocaleDateString('pt-BR')}</p>
                            <p class="text-xs text-gray-500">Lote: ${product.batchNumber}</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">Validade</p>
                            <p class="font-semibold">${new Date(product.expiryDate).toLocaleDateString('pt-BR')}</p>
                            <p class="text-xs ${product.status === 'V√°lido' ? 'text-green-400' : 'text-red-400'}">
                                Status: ${product.status}
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">Local de Fabrica√ß√£o</p>
                            <p class="font-semibold">${product.manufacturingLocation}</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 pt-6 border-t border-white/10">
                    <div class="bg-purple-500/10 rounded-xl p-4 text-center">
                        <p class="text-3xl font-bold text-purple-400">${product.scanCount}</p>
                        <p class="text-sm text-gray-400">Verifica√ß√µes</p>
                    </div>
                    <div class="bg-pink-500/10 rounded-xl p-4 text-center">
                        <p class="text-3xl font-bold text-pink-400">${product.ageInDays}</p>
                        <p class="text-sm text-gray-400">Dias desde fabrica√ß√£o</p>
                    </div>
                </div>

                <button 
                    onclick="location.reload()"
                    class="w-full py-3 bg-white/10 rounded-xl hover:bg-white/20 transition-all"
                >
                    Verificar Outro Produto
                </button>
            `;
        }

        function showError(error) {
            document.getElementById('scan-area').innerHTML = '';
            document.getElementById('result-area').className = 'bg-red-500/10 border-2 border-red-500/50 rounded-xl p-6';
            document.getElementById('result-area').innerHTML = `
                <div class="text-center mb-6">
                    <div class="inline-block p-4 bg-red-500/20 rounded-full mb-4">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-red-400">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-red-400 mb-2">Produto N√£o Autenticado</h3>
                    <p class="text-gray-300">${error}</p>
                </div>

                <div class="bg-red-500/20 rounded-xl p-4 mb-6">
                    <h4 class="font-bold mb-2 text-red-300">Aten√ß√£o</h4>
                    <ul class="text-sm text-gray-300 space-y-1">
                        <li>‚Ä¢ Este produto n√£o foi verificado como aut√™ntico</li>
                        <li>‚Ä¢ Pode ser falsificado ou n√£o autorizado</li>
                        <li>‚Ä¢ Entre em contato com Make Beauty</li>
                    </ul>
                </div>

                <button 
                    onclick="location.reload()"
                    class="w-full py-3 bg-red-500/20 rounded-xl hover:bg-red-500/30 transition-all"
                >
                    Tentar Novamente
                </button>
            `;
        }
    </script>
</body>
</html>