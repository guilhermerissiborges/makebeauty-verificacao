<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueTouch™ - Verificação Make Beauty</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .animate-gradient {
            background-size: 200% 200%;
            animation: gradient 3s ease infinite;
        }
        @keyframes phone-approach {
            0%, 100% { 
                transform: translateY(-20px) scale(1) perspective(1000px) rotateX(0deg);
                opacity: 1;
                filter: blur(0px);
            }
            50% { 
                transform: translateY(80px) scale(0.85) perspective(1000px) rotateX(8deg);
                opacity: 0.95;
                filter: blur(0.5px);
            }
        }
        .animate-phone-approach {
            animation: phone-approach 3.5s ease-in-out infinite;
        }
        @keyframes glow-pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.15); }
        }
        .animate-glow {
            animation: glow-pulse 2s ease-in-out infinite;
        }
        @keyframes tag-glow {
            0%, 100% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.3); }
            50% { box-shadow: 0 0 60px rgba(236, 72, 153, 0.6); }
        }
        .animate-tag-glow {
            animation: tag-glow 2s ease-in-out infinite;
        }
        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(1.4);
                opacity: 0;
            }
        }
        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-black text-white min-h-screen">
    <div class="max-w-2xl mx-auto p-6">
        <div class="text-center mb-8 mt-8">
            <div class="inline-block p-3 bg-gradient-to-r from-pink-500/20 to-purple-500/20 rounded-2xl mb-4">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-pink-400">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
            </div>
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent animate-gradient">
                TrueTouch™
            </h1>
            <p class="text-gray-400">Sistema de Verificação de Autenticidade</p>
        </div>

        <div class="bg-white/5 backdrop-blur-xl rounded-3xl p-8 border border-white/10">
            <div id="scan-area" class="text-center">
                <!-- Visualização com Efeito de Profundidade -->
                <div class="relative w-full max-w-md mx-auto h-[500px] mb-8 flex items-center justify-center">
                    
                    <!-- Tag NFC (Fixa no centro-inferior) -->
                    <div class="absolute bottom-20 left-1/2 -translate-x-1/2">
                        <div class="relative">
                            <!-- Ondas NFC pulsantes -->
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <div class="w-56 h-56 rounded-full border-2 border-purple-500/20 pulse-ring"></div>
                                <div class="absolute w-56 h-56 rounded-full border-2 border-pink-500/20 pulse-ring" style="animation-delay: 0.7s;"></div>
                                <div class="absolute w-56 h-56 rounded-full border-2 border-purple-500/20 pulse-ring" style="animation-delay: 1.4s;"></div>
                            </div>
                            
                            <!-- Tag/Produto -->
                            <div class="relative z-10 w-44 h-44 bg-gradient-to-br from-purple-900/70 to-pink-900/70 rounded-3xl backdrop-blur-xl border-2 border-purple-500/40 flex flex-col items-center justify-center shadow-2xl animate-tag-glow">
                                <!-- Logo TrueTouch -->
                                <svg width="70" height="70" viewBox="0 0 24 24" fill="none" class="mb-3">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" 
                                          fill="url(#tag-shield-gradient)" 
                                          stroke="url(#tag-shield-stroke)" 
                                          stroke-width="1.5">
                                        <animate attributeName="opacity" values="0.9;1;0.9" dur="2s" repeatCount="indefinite"/>
                                    </path>
                                    <defs>
                                        <linearGradient id="tag-shield-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#ec4899"/>
                                            <stop offset="100%" style="stop-color:#a855f7"/>
                                        </linearGradient>
                                        <linearGradient id="tag-shield-stroke" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#fdf4ff"/>
                                            <stop offset="100%" style="stop-color:#e9d5ff"/>
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <div class="text-base font-bold bg-gradient-to-r from-pink-200 to-purple-200 bg-clip-text text-transparent">
                                    TrueTouch™
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Smartphone (Menor, afundando na tag) -->
                    <div class="absolute top-20 left-1/2 -translate-x-1/2 animate-phone-approach" style="transform-style: preserve-3d;">
                        <!-- Sombra do celular que aumenta -->
                        <div class="absolute top-full left-1/2 -translate-x-1/2 w-40 h-6 bg-purple-500/30 blur-2xl rounded-full animate-glow" style="margin-top: 15px;"></div>
                        
                        <!-- Celular -->
                        <div class="relative w-40 bg-gradient-to-br from-gray-800 to-gray-900 rounded-[2.5rem] p-2.5 shadow-2xl border-2 border-gray-700" style="transform-style: preserve-3d;">
                            <!-- Tela -->
                            <div class="relative bg-black rounded-[2rem] overflow-hidden">
                                <!-- Status Bar -->
                                <div class="h-8 bg-gradient-to-b from-gray-900/80 to-transparent flex items-center justify-between px-4 text-white text-[9px]">
                                    <span class="font-semibold">9:41</span>
                                    <div class="flex gap-1.5 items-center">
                                        <svg width="12" height="9" viewBox="0 0 15 11" fill="currentColor">
                                            <rect width="2.5" height="11" rx="1"/>
                                            <rect x="3.5" y="3" width="2.5" height="8" rx="1"/>
                                            <rect x="7" y="5" width="2.5" height="6" rx="1"/>
                                            <rect x="10.5" y="2" width="2.5" height="9" rx="1"/>
                                        </svg>
                                        <svg width="20" height="10" viewBox="0 0 25 12">
                                            <rect x="1" y="2" width="16" height="8" rx="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                            <rect x="3.5" y="4" width="11" height="4" rx="1" fill="currentColor"/>
                                            <rect x="18" y="4" width="3" height="4" rx="1" fill="currentColor"/>
                                        </svg>
                                    </div>
                                </div>
                                
                                <!-- Conteúdo da Tela -->
                                <div class="px-4 py-10 pb-16 bg-gradient-to-br from-gray-950 via-purple-950/30 to-gray-950 flex flex-col items-center justify-center min-h-[280px]">
                                    <!-- Logo TrueTouch Animado -->
                                    <div class="relative mb-6">
                                        <!-- Glow -->
                                        <div class="absolute inset-0 bg-gradient-to-r from-pink-500 to-purple-600 blur-2xl opacity-60 animate-pulse"></div>
                                        
                                        <!-- Shield -->
                                        <svg width="65" height="65" viewBox="0 0 24 24" fill="none" class="relative">
                                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" 
                                                  fill="url(#phone-shield-gradient)" 
                                                  stroke="url(#phone-shield-stroke)" 
                                                  stroke-width="1.5">
                                                <animateTransform
                                                    attributeName="transform"
                                                    type="scale"
                                                    values="1;1.08;1"
                                                    dur="2s"
                                                    repeatCount="indefinite"
                                                    additive="sum"/>
                                            </path>
                                            <defs>
                                                <linearGradient id="phone-shield-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#ec4899">
                                                        <animate attributeName="stop-color" values="#ec4899;#f472b6;#ec4899" dur="3s" repeatCount="indefinite"/>
                                                    </stop>
                                                    <stop offset="100%" style="stop-color:#a855f7">
                                                        <animate attributeName="stop-color" values="#a855f7;#c084fc;#a855f7" dur="3s" repeatCount="indefinite"/>
                                                    </stop>
                                                </linearGradient>
                                                <linearGradient id="phone-shield-stroke" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#fdf4ff"/>
                                                    <stop offset="100%" style="stop-color:#fae8ff"/>
                                                </linearGradient>
                                            </defs>
                                        </svg>
                                    </div>
                                    
                                    <!-- Texto TrueTouch -->
                                    <h3 class="text-2xl font-bold mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-pink-400 bg-clip-text text-transparent" style="background-size: 200% 200%; animation: gradient 3s ease infinite;">
                                        TrueTouch™
                                    </h3>
                                    
                                    <p class="text-gray-400 text-center text-[11px] mb-5 max-w-[130px] leading-relaxed">
                                        Aproxime do produto para verificar
                                    </p>
                                    
                                    <!-- Indicador Pronto -->
                                    <div class="relative">
                                        <div class="absolute inset-0 bg-gradient-to-r from-pink-500 to-purple-600 blur-lg opacity-60"></div>
                                        <div class="relative px-6 py-2 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full text-white text-xs font-semibold shadow-lg">
                                            Pronto
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Home Indicator -->
                                <div class="absolute bottom-1.5 left-1/2 -translate-x-1/2 w-20 h-1 bg-white/30 rounded-full"></div>
                            </div>
                            
                            <!-- Notch -->
                            <div class="absolute top-2.5 left-1/2 -translate-x-1/2 w-20 h-5 bg-black rounded-b-2xl"></div>
                        </div>
                    </div>
                    
                </div>

                <h2 class="text-2xl font-bold mb-3">Verificação de Autenticidade</h2>
                <p class="text-gray-400 mb-8 max-w-md mx-auto leading-relaxed">
                    Aproxime seu smartphone da tag TrueTouch™ para confirmar instantaneamente a originalidade do seu produto Make Beauty
                </p>
                
                <div class="space-y-3">
                    <button 
                        onclick="scanNFC()"
                        class="w-full py-4 px-6 bg-gradient-to-r from-pink-500 to-purple-600 rounded-xl font-semibold hover:shadow-2xl hover:shadow-pink-500/50 transition-all"
                    >
                        Escanear NFC
                    </button>
                    
                    <button 
                        onclick="simulateScan()"
                        class="w-full py-4 px-6 bg-white/10 border border-white/20 rounded-xl font-semibold hover:bg-white/20 transition-all"
                    >
                        Demonstração (Simular)
                    </button>

                    <div class="pt-4 border-t border-white/10">
                        <p class="text-sm text-gray-400 mb-3">Modo Teste - Digite um UID da planilha:</p>
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                id="test-uid" 
                                placeholder="Ex: 04:E3:2A:1B:5F:80:80"
                                class="flex-1 px-4 py-3 bg-white/5 border border-white/20 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-pink-500"
                            />
                            <button 
                                onclick="testWithUID()"
                                class="px-6 py-3 bg-blue-500/80 hover:bg-blue-500 rounded-xl font-semibold transition-all"
                            >
                                Testar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="result-area" class="hidden"></div>
        </div>

        <div class="text-center text-sm text-gray-500 mt-8 space-y-3">
            <div class="flex items-center justify-center gap-2">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-purple-400">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 16v-4"></path>
                    <path d="M12 8h.01"></path>
                </svg>
                <span class="text-gray-400">O sensor NFC geralmente fica na parte traseira superior do smartphone</span>
            </div>
            <div class="pt-2 border-t border-white/10">
                <p class="font-medium text-gray-400">Protegido por TrueTouch™</p>
                <p class="text-gray-600 text-xs mt-1">Tecnologia anti-falsificação Make Beauty</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://makebeauty-nfc-backend.onrender.com';

        async function scanNFC() {
            if (!('NDEFReader' in window)) {
                alert('Seu navegador não suporta NFC. Use Chrome no Android para escanear tags reais.');
                return;
            }

            try {
                const ndef = new NDEFReader();
                await ndef.scan();
                
                document.getElementById('scan-area').innerHTML = `
                    <div class="text-center py-8">
                        <div class="w-24 h-24 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                        <h3 class="text-xl font-bold mb-2">Escaneando...</h3>
                        <p class="text-gray-400">Mantenha o celular próximo à tag NFC</p>
                    </div>
                `;

                ndef.addEventListener('reading', async ({ message, serialNumber }) => {
                    const uid = serialNumber;
                    
                    let signature = '';
                    let counter = 0;
                    
                    for (const record of message.records) {
                        const decoder = new TextDecoder();
                        const data = decoder.decode(record.data);
                        const parts = data.split(':');
                        if (parts.length === 2) {
                            signature = parts[0];
                            counter = parseInt(parts[1]);
                        }
                    }

                    if (!signature) {
                        const array = new Uint8Array(32);
                        crypto.getRandomValues(array);
                        signature = Array.from(array).map(b => b.toString(16).padStart(2, '0')).join('');
                        counter = Math.floor(Math.random() * 100);
                    }

                    await verifyProduct(uid, signature, counter);
                });

            } catch (error) {
                alert('Erro ao iniciar scanner: ' + error.message);
            }
        }

        async function simulateScan() {
            document.getElementById('scan-area').innerHTML = `
                <div class="text-center py-8">
                    <div class="w-24 h-24 border-4 border-pink-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                    <h3 class="text-xl font-bold mb-2">Simulando scan...</h3>
                </div>
            `;

            setTimeout(async () => {
                const uid = '04:AA:BB:CC:DD:EE:FF';
                const array = new Uint8Array(32);
                crypto.getRandomValues(array);
                const signature = Array.from(array).map(b => b.toString(16).padStart(2, '0')).join('');
                const counter = Math.floor(Math.random() * 100);
                await verifyProduct(uid, signature, counter);
            }, 2000);
        }

        async function testWithUID() {
            const input = document.getElementById('test-uid');
            let uid = input.value.trim();

            if (!uid) {
                alert('Digite um UID para testar');
                return;
            }

            uid = uid.replace(/[^0-9A-Fa-f]/g, '');
            
            if (uid.length < 14) {
                alert('UID inválido. Digite no formato: 04:E3:2A:1B:5F:80:80');
                return;
            }

            const formattedUID = uid.match(/.{1,2}/g).join(':').toUpperCase();

            document.getElementById('scan-area').innerHTML = `
                <div class="text-center py-8">
                    <div class="w-24 h-24 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                    <h3 class="text-xl font-bold mb-2">Testando UID...</h3>
                    <p class="text-gray-400 text-sm">${formattedUID}</p>
                </div>
            `;

            const array = new Uint8Array(32);
            crypto.getRandomValues(array);
            const signature = Array.from(array).map(b => b.toString(16).padStart(2, '0')).join('');
            const counter = Math.floor(Math.random() * 100);

            await verifyProduct(formattedUID, signature, counter);
        }

        async function verifyProduct(uid, signature, counter) {
            try {
                const response = await fetch(`${API_URL}/api/verify-product`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ uid, signature, counter, location: 'Web' })
                });

                const data = await response.json();

                if (data.success && data.authentic) {
                    showSuccess(data.product);
                } else {
                    showError(data.error);
                }

            } catch (error) {
                showError('Erro ao conectar com servidor: ' + error.message);
            }
        }

        function showSuccess(product) {
            document.getElementById('scan-area').innerHTML = '';
            document.getElementById('result-area').className = 'space-y-6';
            document.getElementById('result-area').innerHTML = `
                <div class="text-center pb-6 border-b border-white/10">
                    <div class="inline-block p-4 bg-green-500/20 rounded-full mb-4">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-400">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-green-400 mb-2">Produto Autêntico</h3>
                    <p class="text-gray-400">Este produto Make Beauty é 100% original</p>
                </div>

                <div class="space-y-4">
                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">Produto</p>
                            <p class="font-semibold">${product.name}</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">ID do Produto</p>
                            <p class="font-mono text-sm">${product.productId}</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">Fabricação</p>
                            <p class="font-semibold">${new Date(product.manufacturingDate).toLocaleDateString('pt-BR')}</p>
                            <p class="text-xs text-gray-500">Lote: ${product.batchNumber}</p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">Validade</p>
                            <p class="font-semibold">${new Date(product.expiryDate).toLocaleDateString('pt-BR')}</p>
                            <p class="text-xs ${product.status === 'Válido' ? 'text-green-400' : 'text-red-400'}">
                                Status: ${product.status}
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start gap-3">
                        <svg width="20" height="20" class="text-purple-400 mt-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <div class="flex-1">
                            <p class="text-sm text-gray-400">Local de Fabricação</p>
                            <p class="font-semibold">${product.manufacturingLocation}</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 pt-6 border-t border-white/10">
                    <div class="bg-purple-500/10 rounded-xl p-4 text-center">
                        <p class="text-3xl font-bold text-purple-400">${product.scanCount}</p>
                        <p class="text-sm text-gray-400">Verificações</p>
                    </div>
                    <div class="bg-pink-500/10 rounded-xl p-4 text-center">
                        <p class="text-3xl font-bold text-pink-400">${product.ageInDays}</p>
                        <p class="text-sm text-gray-400">Dias desde fabricação</p>
                    </div>
                </div>

                <button 
                    onclick="location.reload()"
                    class="w-full py-3 bg-white/10 rounded-xl hover:bg-white/20 transition-all"
                >
                    Verificar Outro Produto
                </button>
            `;
        }

        function showError(error) {
            document.getElementById('scan-area').innerHTML = '';
            document.getElementById('result-area').className = 'bg-red-500/10 border-2 border-red-500/50 rounded-xl p-6';
            document.getElementById('result-area').innerHTML = `
                <div class="text-center mb-6">
                    <div class="inline-block p-4 bg-red-500/20 rounded-full mb-4">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-red-400">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-red-400 mb-2">Produto Não Autenticado</h3>
                    <p class="text-gray-300">${error}</p>
                </div>

                <div class="bg-red-500/20 rounded-xl p-4 mb-6">
                    <h4 class="font-bold mb-2 text-red-300">Atenção</h4>
                    <ul class="text-sm text-gray-300 space-y-1">
                        <li>• Este produto não foi verificado como autêntico</li>
                        <li>• Pode ser falsificado ou não autorizado</li>
                        <li>• Entre em contato com Make Beauty</li>
                    </ul>
                </div>

                <button 
                    onclick="location.reload()"
                    class="w-full py-3 bg-red-500/20 rounded-xl hover:bg-red-500/30 transition-all"
                >
                    Tentar Novamente
                </button>
            `;
        }
    </script>
</body>
</html>